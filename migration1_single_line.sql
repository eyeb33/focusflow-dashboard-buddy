ALTER TABLE topic_sessions ADD COLUMN IF NOT EXISTS attempted_problems INTEGER DEFAULT 0, ADD COLUMN IF NOT EXISTS correct_problems INTEGER DEFAULT 0, ADD COLUMN IF NOT EXISTS hints_used INTEGER DEFAULT 0, ADD COLUMN IF NOT EXISTS exam_style_attempts INTEGER DEFAULT 0, ADD COLUMN IF NOT EXISTS exam_style_correct INTEGER DEFAULT 0, ADD COLUMN IF NOT EXISTS mastery_level TEXT DEFAULT 'not-started', ADD COLUMN IF NOT EXISTS common_mistakes JSONB DEFAULT '[]'::jsonb, ADD COLUMN IF NOT EXISTS strength_areas JSONB DEFAULT '[]'::jsonb; CREATE INDEX IF NOT EXISTS idx_topic_sessions_mastery ON topic_sessions(user_id, mastery_level); CREATE INDEX IF NOT EXISTS idx_topic_sessions_user_topic ON topic_sessions(user_id, topic_id, active_subtopic);